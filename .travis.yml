dist: trusty

language: python
matrix:
  include:
  - os: linux
    python: 3.7
    dist: xenial
    sudo: true
    env: BUILD=PYPI
  - os: linux
    python: 3.8
    dist: xenial
    sudo: true

install:
- pip install -r requirements/dev.txt
- pip install -r requirements/test.txt
- pip install pytest-cov

script:
- flake8
- python setup.py test
- sonar-scanner

after_success:
- bash <(curl -s https://codecov.io/bash)

addons:
  sonarcloud:
    organization: "cloudbluesonarcube"
    token:
      secure: VJcQOn8TekNPIEn/vnf4fHGZoHha1hoeIVGGT9sYHfqe6zjofbQqAaGO3HMVR7Oliqxe1GQkiw2g+J5YdnRSvqqt2B6EPRiJXJW2jF0irwZ+zsrs/h5LcnQvp6KcIEjC9XmYh3gtkL7GF4Afola0Co4kic7+G2icExKE9JZCfEPExIgjZ6tkx74i0sIbUpdVNas8ODiPwXYcia0DBBh/1NT6p0X4wduSsWEC98rkxWZEyqtMLgL9hkO8TyihnNxsPCpK+ocyAtVmBG0P52A7iGHOi3JjzxVOQXntXhutdJsFXs+wcnFZfKHZf5lwfSKuY45DBr6s5iXo7mWADau3TJ2WeKasK/Bs20iLu2yJArNVqCAKqyA92YBRltowxYlNt3ewK6NrMyETvK0GVzrnBet0jVBfWPztJYi5HdUQZjfHMOiFE4k2kX1sWWI3uSDMS03vppzwo3T+InaZoj/fJaqsOGXMSlkRyKWa8jeK6556pYKo784WdYthijR2sOxdLck19ZaeplI+t3Pre9mGPlKw1gn/TqCPfQaFstYwede4qk+OzPthfDJh/jSobQgHiGhq9C0vzAn+ftSAEYJupNRt33uX18NSf2nH6N9mBaBF7cuSZrWTKmR1D00f4laIv5w+hI/xVq079BJe9xdK0gtxfZcdGMUowILcA+i2PV4=

deploy:
  skip_cleanup: true
  provider: pypi
  user: apslite
  password:
    secure: ExTPi3iFphLulYobxzCb1HkD6u1P1tcIvp0N6XAEYZHF7YR5W1ATXudoZzx+aFxB1LyFPCX2KSRyiShRChswIIslt31V60iMf9deOyEiG+Ay4crJt+v3SjoJiKzV7I1dE2v20WKvJfjgH+7iRv3thvxE/41udH7tAaBqQB7TjwkamSLwgum9wqz3M+b0Pc2ea+/6KBcS/VKnarev6PZQ7mh1/KdWmDxi6uLaeefnSnNwkjaOaTvy1P6UiPiB82LFCNZ491688W/v48SqSatVjYOi0sn2Wc6E6N/+50wz31eDy0/vIGvLHWKIzwE7MHMdFRf5E805SHhfQJZ3f3VDVR8Jx0lxhw0scG/nwYwRVFQjEjWzINIsggxcbK4hQnAU5Y32SY0oKKP9TgH2eSCYGuUz3i8cz2CUaI69l5NoSPwvBiDq6yw4TSRPQIaJPqaHoQdbPgMZoUhFrj1FIjc9T0FGWHBqwCOnqPf+1N8ng7kSygQzMRpICVMlSj6HHDe7Z1ruXcTiKJPu/i+8HokCSxJBxXA0E22W5dgXiLyfmBo7Hw97g7+vfknUgqR2YnKepCnNErNRES3HZbi2I8IduxkBL4W/+J/6AXuOhgz/qi8NDWrUpMA9Ws30NZxXGTY+4vlUqqNYJSzLouoFdWOudKUKZFzL2usfGuqUQDQMLeE=
  on:
    tags: true
    all_branches: true
    distributions: sdist
    condition: "$BUILD = PYPI"
